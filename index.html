<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Matematik OyunlarÄ± â€” matbilzek</title>
  <meta name="description" content="EÄŸitsel matematik oyunlarÄ± â€” Ä°lkokul, Ortaokul(6. sÄ±nÄ±f) ve HafÄ±za oyunlarÄ±. Mobil uyumlu." />
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#fffaf0;
      --card:#ffffff;
      --accent:#ff6b6b;
      --accent-2:#ffd166;
      --accent-3:#4ecdc4;
      --text:#2b2b2b;
      --muted:#6b7280;
      --radius:16px;
      --container:980px;
      font-family:'Fredoka', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      background:linear-gradient(180deg,#fffaf0 0%, #f0fbff 100%);
      color:var(--text);
      line-height:1.4;
      padding-bottom:4rem;
      font-size:16px;
    }

    .site-header{background:linear-gradient(90deg,#fff,#fff7f0);box-shadow:0 6px 18px rgba(11,22,44,0.06);position:sticky;top:0;z-index:20;border-bottom:6px solid rgba(78,205,196,0.06)}
    .bar{display:flex;justify-content:space-between;align-items:center;padding:0.8rem 1rem}
    .logo{font-weight:800;color:var(--accent-3);text-decoration:none;font-size:1.15rem;letter-spacing:0.6px}
    .subbar{padding:0 1rem 0.6rem 1rem}
    .tabs{display:flex;gap:0.4rem;overflow:auto;padding-bottom:0.25rem}
    .tab{background:transparent;border:0;padding:0.55rem 0.8rem;border-radius:12px;font-weight:700;color:var(--muted);font-size:18px;cursor:pointer}
    .tab.active{background:linear-gradient(90deg, rgba(78,205,196,0.12), rgba(255,177,101,0.08));color:var(--accent-3);box-shadow:0 6px 20px rgba(78,205,196,0.06)}

    .container{width:92%;max-width:var(--container);margin:1rem auto}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:1rem}
    .card{background:var(--card);padding:1rem;border-radius:16px;box-shadow:0 10px 30px rgba(11,22,44,0.06);border:1px solid rgba(11,22,44,0.04)}
    .card h3{margin:0 0 0.5rem 0;font-size:1.05rem}
    .card p{margin:0;color:var(--muted);font-size:0.9rem}
    .card-actions{display:flex;gap:0.5rem;justify-content:flex-end;margin-top:0.8rem;flex-wrap:wrap}
    
    .btn{background:linear-gradient(90deg,var(--accent),#ff9a8b);color:white;border:0;padding:0.75rem 1rem;border-radius:999px;font-weight:800;cursor:pointer;font-size:0.95rem;box-shadow:0 8px 20px rgba(255,107,107,0.12);transition:transform 0.1s}
    .btn:active{transform:translateY(1px)}
    .btn.go{background:linear-gradient(90deg,var(--accent-3),#4ecdc4)}
    .btn-secondary{background:linear-gradient(90deg,#a78bfa,#c084fc);font-size:0.85rem;padding:0.6rem 0.9rem}

    .panel{margin-top:1rem}
    .hidden{display:none}
    .back{margin-top:0.6rem}
    .muted{color:var(--muted)}
    .small{font-size:0.85rem}

    /* Modal Stilleri */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:100;align-items:center;justify-content:center}
    .modal.active{display:flex}
    .modal-content{background:var(--card);border-radius:20px;padding:1.5rem;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(11,22,44,0.2)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;border-bottom:2px solid rgba(78,205,196,0.1);padding-bottom:0.8rem}
    .modal-title{font-size:1.3rem;font-weight:800;color:var(--accent-3)}
    .modal-close{background:transparent;border:0;font-size:1.8rem;cursor:pointer;color:var(--muted);padding:0;width:32px;height:32px;line-height:1}
    .modal-body{margin:1rem 0}
    .modal-footer{display:flex;gap:0.5rem;justify-content:flex-end;margin-top:1rem;padding-top:1rem;border-top:2px solid rgba(78,205,196,0.1)}

    /* Liderlik Tablosu Stilleri */
    .lb-item{display:flex;justify-content:space-between;align-items:center;padding:0.8rem;margin-bottom:0.5rem;background:linear-gradient(90deg,#fff,#fffbf8);border-radius:12px;border:1px solid rgba(11,22,44,0.04)}
    .lb-rank{background:linear-gradient(135deg,var(--accent-3),#4ecdc4);color:white;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:0.9rem}
    .lb-name{font-weight:700;color:var(--text)}
    .lb-score{font-weight:800;color:var(--accent);font-size:1.1rem}
    .lb-source{text-align:center;margin-top:1rem;font-size:0.85rem;color:var(--muted);font-style:italic}

    .site-footer{margin-top:3rem;padding:2rem 0;text-align:center;border-top:1px solid rgba(11,22,44,0.06)}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="bar">
      <a class="logo" href="/">Matematik OyunlarÄ±</a>
    </div>
    <div class="subbar">
      <div class="tabs">
        <button class="tab active" data-target="home">Ana Sayfa</button>
        <button class="tab" data-target="ilkokul">Ä°LKOKUL</button>
        <button class="tab" data-target="ortaokul">ORTAOKUL (6. SÄ±nÄ±f)</button>
        <button class="tab" data-target="hafiza">HAFIZA OYUNLARI</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="home" class="panel">
      <h1>HoÅŸ geldin! Bir seviye seÃ§ ve oyna.</h1>
      <p>Ä°LKOKUL: Toplama, Ã‡Ä±karma, Ã‡arpma, BÃ¶lme. ORTAOKUL (6. sÄ±nÄ±f): asal sayÄ±lar, Ã§arpanlar, EBOB/EKOK, denk kesirler, kesir dÃ¶nÃ¼ÅŸÃ¼mleri, ortalama/ortanca/tepe-deÄŸer. HAFIZA: ÅŸekiller ve hafÄ±za kartlarÄ±.</p>

      <div class="cards">
        <article class="card">
          <h3>Ä°LKOKUL</h3>
          <p>Toplama, Ã‡Ä±karma, Ã‡arpma, BÃ¶lme â€” temel hesaplama oyunlarÄ±.</p>
          <div class="card-actions">
            <button class="btn go" data-target="ilkokul">Git</button>
          </div>
        </article>

        <article class="card">
          <h3>ORTAOKUL (6. SÄ±nÄ±f)</h3>
          <p>Asal sayÄ±lar, Ã§arpanlar, EBOB/EKOK, denk kesirler, kesir dÃ¶nÃ¼ÅŸÃ¼mleri, ortalama/ortanca/tepe.</p>
          <div class="card-actions">
            <button class="btn go" data-target="ortaokul">Git</button>
          </div>
        </article>

        <article class="card">
          <h3>HAFIZA OYUNLARI</h3>
          <p>Åekiller & HafÄ±za KartlarÄ± â€” geliÅŸtirilmiÅŸ oyun deneyimi.</p>
          <div class="card-actions">
            <button class="btn go" data-target="hafiza">Git</button>
          </div>
        </article>
      </div>
    </section>

    <!-- ILKOKUL -->
    <section id="ilkokul" class="panel hidden">
      <h2>Ä°LKOKUL OYUNLARI</h2>
      <div class="cards">
        <article class="card">
          <h3>Toplama</h3>
          <p>KÄ±sa sÃ¼reli yarÄ±ÅŸ: hÄ±zlÄ± ve doÄŸru cevapla puan topla.</p>
          <div class="card-actions">
            <button class="btn go" data-target="addition">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('addition')">ğŸ† SÄ±ralama</button>
          </div>
        </article>
        <article class="card">
          <h3>Ã‡Ä±karma</h3>
          <p>Negatif olmadan rahat alÄ±ÅŸtÄ±rma.</p>
          <div class="card-actions">
            <button class="btn go" data-target="subtraction">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('subtraction')">ğŸ† SÄ±ralama</button>
          </div>
        </article>
        <article class="card">
          <h3>Ã‡arpma</h3>
          <p>Ã‡arpÄ±m tablosu alÄ±ÅŸtÄ±rmasÄ±.</p>
          <div class="card-actions">
            <button class="btn go" data-target="multiplication">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('multiplication')">ğŸ† SÄ±ralama</button>
          </div>
        </article>
        <article class="card">
          <h3>BÃ¶lme</h3>
          <p>Tam bÃ¶lÃ¼nen sorularla kolay bÃ¶lme.</p>
          <div class="card-actions">
            <button class="btn go" data-target="division">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('division')">ğŸ† SÄ±ralama</button>
          </div>
        </article>
      </div>
      <div class="back"><button class="btn tab" data-target="home">Geri</button></div>
    </section>

    <!-- ORTAOKUL -->
    <section id="ortaokul" class="panel hidden">
      <h2>ORTAOKUL (6. SINIF) OYUNLARI</h2>
      <div class="cards">
        <article class="card">
          <h3>Asal SayÄ±lar</h3>
          <p>Verilen sayÄ± asal mÄ±? yada hangileri asal?</p>
          <div class="card-actions">
            <button class="btn" id="start-prime">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('prime')">ğŸ† SÄ±ralama</button>
          </div>
        </article>

        <article class="card">
          <h3>Ã‡arpanlar</h3>
          <p>SayÄ±yÄ± Ã§arpanlarÄ±na ayÄ±r veya doÄŸru Ã§arpanÄ± seÃ§.</p>
          <div class="card-actions">
            <button class="btn" id="start-factors">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('factors')">ğŸ† SÄ±ralama</button>
          </div>
        </article>

        <article class="card">
          <h3>Ortak BÃ¶len / Ortak Kat (EBOB / EKOK)</h3>
          <p>Ä°ki sayÄ± iÃ§in en bÃ¼yÃ¼k ortak bÃ¶len veya en kÃ¼Ã§Ã¼k ortak katÄ± seÃ§.</p>
          <div class="card-actions">
            <button class="btn" id="start-gcdlcm">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('gcdlcm')">ğŸ† SÄ±ralama</button>
          </div>
        </article>

        <article class="card">
          <h3>Denk Kesirler</h3>
          <p>EÅŸdeÄŸer kesirleri bul veya hangi kesir daha bÃ¼yÃ¼k?</p>
          <div class="card-actions">
            <button class="btn" id="start-frac6">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('fractions')">ğŸ† SÄ±ralama</button>
          </div>
        </article>

        <article class="card">
          <h3>Tam SayÄ±lÄ± Kesri â†’ BileÅŸik Kesre Ã‡evirme</h3>
          <p>Miks kesri bileÅŸik (improper) kesre Ã§evir.</p>
          <div class="card-actions">
            <button class="btn" id="start-mixed">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('mixed')">ğŸ† SÄ±ralama</button>
          </div>
        </article>

        <article class="card">
          <h3>Aritmetik Ortalama / Ortanca / Tepe DeÄŸer</h3>
          <p>KÃ¼Ã§Ã¼k veri setleriyle ortalama, ortanca (median) ve mod (tepe deÄŸeri) hesapla.</p>
          <div class="card-actions">
            <button class="btn" id="start-stats">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('stats')">ğŸ† SÄ±ralama</button>
          </div>
        </article>
      </div>
      <div class="back"><button class="btn tab" data-target="home">Geri</button></div>
    </section>

    <!-- HAFIZA -->
    <section id="hafiza" class="panel hidden">
      <h2>HAFIZA OYUNLARI</h2>
      <div class="cards">
        <article class="card">
          <h3>Åekiller</h3>
          <p>Hedef ÅŸekli bul â€” renkli, bÃ¼yÃ¼k gÃ¶rsellerle.</p>
          <div class="card-actions">
            <button class="btn go" data-target="shapes">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('shapes')">ğŸ† SÄ±ralama</button>
          </div>
        </article>

        <article class="card">
          <h3>HafÄ±za KartlarÄ±</h3>
          <p>Seviye tabanlÄ±: kolay/orta/zor; sÃ¼re & puanlama; gÃ¶rsel kartlar.</p>
          <div class="card-actions">
            <button class="btn go" data-target="memory">Oyna</button>
            <button class="btn btn-secondary" onclick="openLeaderboard('memory')">ğŸ† SÄ±ralama</button>
          </div>
        </article>
      </div>
      <div class="back"><button class="btn tab" data-target="home">Geri</button></div>
    </section>

    <!-- Oyun panelleri burada olacak -->
    <section id="addition" class="panel hidden">
      <h2>Toplama Oyunu</h2>
      <p class="muted">Oyun kodlarÄ± mevcut app.js dosyanÄ±zla Ã§alÄ±ÅŸacak ÅŸekilde ayarlanmalÄ±.</p>
      <div class="back"><button class="btn tab" data-target="ilkokul">Geri</button></div>
    </section>

  </main>

  <!-- Liderlik Tablosu Modal -->
  <div id="leaderboard-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="lb-title" class="modal-title">Liderlik Tablosu</h2>
        <button class="modal-close" onclick="closeLeaderboard()">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="lb-list"></div>
        <div id="lb-source-note" class="lb-source"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="submitScoreUI()">ğŸ“¤ Skor GÃ¶nder</button>
        <button class="btn" onclick="refreshLeaderboard()">ğŸ”„ Yenile</button>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container">
      <p>Â© <span id="year"></span> matbilzek â€” EÄŸitsel matematik oyunlarÄ±</p>
      <p class="muted small">Skorlar Claude'un kalÄ±cÄ± depolama sistemi ile saklanÄ±r. Global skorlar tÃ¼m kullanÄ±cÄ±lar tarafÄ±ndan gÃ¶rÃ¼lebilir.</p>
    </div>
  </footer>

  <script>
    // Tab navigation
    const tabs = Array.from(document.querySelectorAll('.tab, .go'));
    const panels = Array.from(document.querySelectorAll('.panel'));
    
    function showPanel(id) {
      panels.forEach(p => p.id === id ? p.classList.remove('hidden') : p.classList.add('hidden'));
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.target === id));
      window.scrollTo({top: 0, behavior: 'smooth'});
    }
    
    tabs.forEach(t => t.addEventListener('click', () => { 
      const target = t.dataset.target; 
      if (target) showPanel(target); 
    }));

    // ===== CLAUDE STORAGE API =====
    
    let currentGame = '';

    // KiÅŸisel skor kaydetme
    async function saveLocalScore(game, score, name = 'Anon') {
      try {
        const key = `score:${game}:${Date.now()}`;
        const value = JSON.stringify({ score, name, date: new Date().toISOString() });
        const result = await window.storage.set(key, value, false);
        return result !== null;
      } catch (e) {
        console.warn('Skor kaydedilemedi:', e);
        return false;
      }
    }

    // KiÅŸisel en iyi skorlarÄ± getir
    async function getLocalTop(game, n = 10) {
      try {
        const result = await window.storage.list(`score:${game}:`, false);
        if (!result || !result.keys) return [];
        
        const scores = [];
        for (const key of result.keys) {
          try {
            const data = await window.storage.get(key, false);
            if (data && data.value) {
              scores.push(JSON.parse(data.value));
            }
          } catch (e) {
            console.warn('Skor okunamadÄ±:', e);
          }
        }
        
        return scores.sort((a, b) => b.score - a.score).slice(0, n);
      } catch (e) {
        console.warn('Yerel skorlar alÄ±namadÄ±:', e);
        return [];
      }
    }

    // Global en iyi skorlarÄ± getir
    async function fetchGlobalTop(game, limit = 10) {
      try {
        const result = await window.storage.list(`global:${game}:`, true);
        if (!result || !result.keys) return { source: 'shared', items: [] };
        
        const scores = [];
        for (const key of result.keys) {
          try {
            const data = await window.storage.get(key, true);
            if (data && data.value) {
              scores.push(JSON.parse(data.value));
            }
          } catch (e) {
            console.warn('Global skor okunamadÄ±:', e);
          }
        }
        
        const sorted = scores.sort((a, b) => b.score - a.score).slice(0, limit);
        return { source: 'shared', items: sorted };
      } catch (e) {
        console.warn('Global skorlar alÄ±namadÄ±, yerel skorlar gÃ¶steriliyor:', e);
        const localScores = await getLocalTop(game, limit);
        return { source: 'local', items: localScores };
      }
    }

    // Global skorlara gÃ¶nder
    async function submitScoreToGlobal(game, name, score) {
      try {
        const key = `global:${game}:${Date.now()}`;
        const value = JSON.stringify({ 
          game, 
          name, 
          score, 
          date: new Date().toISOString() 
        });
        
        const result = await window.storage.set(key, value, true);
        
        if (result) {
          await saveLocalScore(game, score, name);
          return { ok: true, source: 'shared' };
        }
        
        return { ok: false, source: 'local' };
      } catch (e) {
        console.warn('Global skor gÃ¶nderilemedi:', e);
        await saveLocalScore(game, score, name);
        return { ok: false, source: 'local' };
      }
    }

    // Liderlik tablosunu aÃ§
    async function openLeaderboard(game) {
      currentGame = game;
      const modal = document.getElementById('leaderboard-modal');
      const titleEl = document.getElementById('lb-title');
      const listEl = document.getElementById('lb-list');
      
      modal.classList.add('active');
      titleEl.textContent = `${game.toUpperCase()} â€” Liderlik Tablosu`;
      listEl.innerHTML = '<div class="muted">YÃ¼kleniyor...</div>';
      
      await renderLeaderboard(game);
    }

    // Liderlik tablosunu kapat
    function closeLeaderboard() {
      document.getElementById('leaderboard-modal').classList.remove('active');
    }

    // Liderlik tablosunu yenile
    async function refreshLeaderboard() {
      if (currentGame) {
        await renderLeaderboard(currentGame);
      }
    }

    // Liderlik tablosunu render et
    async function renderLeaderboard(game) {
      const listEl = document.getElementById('lb-list');
      const sourceNote = document.getElementById('lb-source-note');
      
      const res = await fetchGlobalTop(game, 10);
      listEl.innerHTML = '';
      
      if (!res.items || res.items.length === 0) {
        listEl.innerHTML = '<div class="muted">HenÃ¼z skor yok. Ä°lk sen ol!</div>';
      } else {
        res.items.forEach((it, idx) => {
          const row = document.createElement('div');
          row.className = 'lb-item';
          row.innerHTML = `
            <div style="display:flex;align-items:center;gap:12px">
              <div class="lb-rank">${idx + 1}</div>
              <div class="lb-name">${escapeHtml(it.name || 'Anonim')}</div>
            </div>
            <div class="lb-score">${escapeHtml(String(it.score))}</div>
          `;
          listEl.appendChild(row);
        });
      }
      
      sourceNote.textContent = res.source === 'shared' 
        ? 'ğŸŒ Kaynak: Global (TÃ¼m KullanÄ±cÄ±lar)' 
        : 'ğŸ’¾ Kaynak: KiÅŸisel';
    }

    // Skor gÃ¶nderme UI
    async function submitScoreUI() {
      if (!currentGame) return;
      
      const localTop = await getLocalTop(currentGame, 1);
      const candidateScore = localTop && localTop.length ? localTop[0].score : null;
      let scoreToSend = candidateScore;
      
      if (scoreToSend === null) {
        const s = prompt('GÃ¶ndermek istediÄŸin skoru gir (sayÄ±):');
        if (!s) return;
        const n = parseInt(s.trim(), 10);
        if (isNaN(n)) { 
          alert('GeÃ§ersiz skor'); 
          return; 
        }
        scoreToSend = n;
      } else {
        const ok = confirm(`En iyi kiÅŸisel skorunuz: ${scoreToSend}\n\nBu skoru global liderlik tablosuna gÃ¶ndermek istiyor musunuz?\n\nâš ï¸ GÃ¶nderilen skorlar tÃ¼m kullanÄ±cÄ±lar tarafÄ±ndan gÃ¶rÃ¼lebilir.`);
        if (!ok) return;
      }
      
      const name = prompt('Takma ad gir (en fazla 18 karakter):', 'Anonim');
      if (name === null) return;
      const nickname = name.trim().slice(0, 18) || 'Anonim';
      
      const res = await submitScoreToGlobal(currentGame, nickname, scoreToSend);
      
      if (res.ok && res.source === 'shared') {
        alert('ğŸ‰ Skorunuz global liderlik tablosuna gÃ¶nderildi!');
      } else {
        alert('âœ… Skorunuz kiÅŸisel olarak kaydedildi.');
      }
      
      await renderLeaderboard(currentGame);
    }

    // HTML escape
    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, c => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      }[c]));
    }

    // Global fonksiyonlarÄ± expose et
    window._saveLocalScore = saveLocalScore;
    window._getLocalTop = getLocalTop;
    window.openLeaderboard = openLeaderboard;
    window.closeLeaderboard = closeLeaderboard;
    window.refreshLeaderboard = refreshLeaderboard;
    window.submitScoreUI = submitScoreUI;

    // Modal dÄ±ÅŸÄ±na tÄ±klayÄ±nca kapat
    document.getElementById('leaderboard-modal').addEventListener('click', (e) => {
      if (e.target.id === 'leaderboard-modal') {
        closeLeaderboard();
      }
    });

    // YÄ±l
    document.getElementById('year').textContent = new Date().getFullYear();

    // BaÅŸlangÄ±Ã§
    showPanel('home');
  </script>
</body>
</html>
